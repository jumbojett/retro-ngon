<!DOCTYPE html>
<html>
    <head>
        <meta name="viewport" content="width=device-width">
        <meta http-equiv="content-type" content="text/html; charset=UTF-8">
        <link rel="stylesheet" type="text/css" href="index.css">
        <title>The retro n-gon renderer</title>
    </head>
    <body>
        <!-- The retro n-gon renderer will render into this canvas.-->
        <canvas id="ngon-sample" class="ngon-canvas ngon-pixelated-upscale"></canvas>

        <!-- The retro n-gon renderer's JS.-->
        <script src="js/retro-ngon/retro_ngon.js"></script>
        <script src="js/retro-ngon/color.js"></script>
        <script src="js/retro-ngon/geometry.js"></script>
        <script src="js/retro-ngon/line_draw.js"></script>
        <script src="js/retro-ngon/matrix44.js"></script>
        <script src="js/retro-ngon/ngon_fill.js"></script>
        <script src="js/retro-ngon/render.js"></script>
        <script src="js/retro-ngon/transform.js"></script>
        <script src="js/retro-ngon/texture.js"></script>
        <script src="js/retro-ngon/canvas.js"></script>

        <!-- Various 3d assets.-->
        <script src="js/mesh-templates/mesh_templates.js"></script>
        <script src="js/mesh-templates/stanford_bunny_res3.js"></script>
        <script src="js/texture-data/texture_data.js"></script>
        <script src="js/texture-data/earth_nasa.js"></script>

        <!-- Sample usage of the retro n-gon renderer.-->
        <script>
            {
                // A collection of functions that return an array of ngons. You'd pass one
                // of these functions to the renderer, which then calls the function to get the
                // set of ngons we want it to render. When calling the function, the renderer
                // will pass in its current count of frames rendered; which we use here to maintain
                // a rotating animation.
                const scenes =
                [
                    // A cube.
                    function(frameCount)
                    {
                        const rotationSpeed = 0.004;
                        return [Rngon.mesh(MeshTemplates.cube(null, true, false),
                                           Rngon.translation_vector(0, 0, 70),
                                           Rngon.rotation_vector((1 - (rotationSpeed * frameCount)), -(1 + (rotationSpeed * frameCount)), 0),
                                           Rngon.scaling_vector(20, 20, 20))];
                    },

                    // A textured disc.
                    function(frameCount)
                    {
                        const rotationSpeed = 0.008;
                        return [Rngon.mesh(MeshTemplates.disc(40, Textures.earth_nasa, true, true),
                                           Rngon.translation_vector(0, 0, 50),
                                           Rngon.rotation_vector(0, (1 + (rotationSpeed * frameCount)), 0),
                                           Rngon.scaling_vector(20, 20, 20))];
                    },

                    // The Stanford bunny.
                    function(frameCount)
                    {
                        const rotationSpeed = 0.008;
                        return [Rngon.mesh(MeshTemplates.stanford_bunny_res3(null, true, false),
                                           Rngon.translation_vector(0, -12, 40),
                                           Rngon.rotation_vector(0.1, (rotationSpeed * frameCount), 0),
                                           Rngon.scaling_vector(1, 1, 1))];
                    },

                    // An analog clock.
                    function(frameCount)
                    {
                        const rotationSpeed = 0.006;
                        return [Rngon.mesh(MeshTemplates.analog_clock(),
                                           Rngon.translation_vector(0, 0, 40),
                                           Rngon.rotation_vector(-0.3, 0.8, -0.6),
                                           Rngon.scaling_vector(0.8, 0.8, 0.8))];
                    },

                    // The Cornell box.
                    function(frameCount)
                    {
                        return [Rngon.mesh(MeshTemplates.cornell_box(true, true),
                                           Rngon.translation_vector(-13.6, -15, 55),
                                           Rngon.rotation_vector(0, 0, 0),
                                           Rngon.scaling_vector(0.05, 0.05, 0.05))];
                    },
                ];

                // Creates a mutable interface that both runs the rendering in sync with
                // the display's refresh rate, and lets us adjust the renderer's parameters.
                // The renderer object itself is created anew each frame, based on the
                // adjustable parameters of this interface.
                const ngonSampleRenderer = ((canvasId, scene = function(){}, stopped = false)=>
                {
                    const publicInterface =
                    {
                        // A function that returns as an array the meshes to be rendered.
                        scene,

                        // The factor by which the canvas' CSS width and height are multiplied
                        // to get the render resolution. The rendering is then upscaled to fit
                        // the CSS dimensions. Higher values of this factor produce more pixelation
                        // and better performance.
                        rendererScale: 0.25,

                        cameraDirection: Rngon.vector3(0, 0, 0),
                        cameraPosition: Rngon.vector3(0, 0, 0),

                        // While true, mesh animations (e.g. rotation) won't be updated; although
                        // the canvas will still be continuously rendered over with the meshes'
                        // state at the time of pausing.
                        paused: false,
                    };

                    // Runs the renderer continuously, in sync with the device's refresh rate.
                    (function render_loop(frameCount = 0)
                    {
                        Rngon.render(canvasId,
                                     publicInterface.scene(frameCount),
                                     publicInterface.cameraPosition,
                                     publicInterface.cameraDirection,
                                     publicInterface.rendererScale,
                                     {depthSort:(publicInterface.scene === scenes[4])? "none" : "painter"});

                        window.requestAnimationFrame(()=>render_loop(frameCount + !publicInterface.paused));
                    })();

                    return publicInterface;
                })("ngon-sample", scenes[0]);

                // Loop through the scenes on a timer.
                setInterval(()=>{ngonSampleRenderer.scene = scenes[(scenes.indexOf(ngonSampleRenderer.scene) + 1) % scenes.length]}, 7000);
            }
        </script>
    </body>
</html>
